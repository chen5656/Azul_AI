# Azul AI 项目 TODO 列表

[x] board.py 中 记分还是错的.

## 环境类实现 (src/game/environment.py)

### 核心功能实现
- [x] 实现 `_initialize_piece_pool()` 方法
  - [x] 创建正确数量的每种颜色的瓷砖
  - [x] 创建先手标记
  - [x] 实现瓷砖的随机打乱
  
- [x] 实现 `start_new_round()` 方法
  - [x] 将瓷砖分配到圆盘
  - [x] 处理剩余瓷砖
  - [x] 重置回合状态

- [x] 实现 `_execute_action()` 方法
  - [x] 从源位置移除瓷砖
  - [x] 处理同色瓷砖的移动
  - [x] 处理非选中颜色瓷砖的移动到待定区
  - [x] 处理先手标记
  - [x] 返回即时奖励

- [x] 实现结算相关方法
  - [x] `_need_scoring()`: 检查是否需要结算
  - [x] `_perform_scoring()`: 执行结算逻辑
  - [x] `_calculate_reward()`: 计算动作奖励
  - [x] `_calculate_final_reward()`: 计算最终奖励

- [x] 实现 `_check_game_end()` 方法
  - [x] 检查结算区是否有完整行
  - [x] 检查回合结束条件

### 改进和优化
- [x] 添加 seed 方法支持随机数种子设置
- [x] 优化 `_get_observation()` 方法
  - [x] 确保所有数组操作使用 np.float32
  - [x] 添加数据范围检查
  - [x] 优化数组操作性能

- [x] 完善 `render()` 方法
  - [x] 实现人类可读的控制台输出
  - [x] 实现 RGB 数组输出
  - [x] 添加可视化选项

### 测试用例编写 (tests/test_environment.py)
- [x] 基础功能测试
  - [x] 测试环境初始化
  - [x] 测试重置功能
  - [x] 测试动作空间和观察空间

- [x] 游戏逻辑测试
  - [x] 测试合法动作生成
  - [x] 测试动作执行
  - [x] 测试结算逻辑
  - [x] 测试游戏结束条件

- [x] 边界情况测试
  - [x] 测试非法动作处理
  - [x] 测试满行/满列情况
  - [x] 测试扣分区溢出情况

### 文档完善
- [x] 添加详细的类和方法文档
- [x] 添加示例代码
- [x] 添加测试覆盖率报告

## 依赖组件实现

### 游戏组件 (src/game/)
- [x] 实现 `Piece` 类
  - [x] 添加颜色属性
  - [x] 添加位置属性
  - [x] 添加特殊标记（如先手标记）

- [x] 完善 `PlayerBoard` 类
  - [x] 实现 `can_place_pieces()` 方法
  - [x] 实现分数计算逻辑
    - [x] 实现行得分计算
    - [x] 实现列得分计算
    - [x] 实现颜色完成奖励
    - [x] 实现扣分计算
  - [x] 实现板块验证逻辑

### 工具类 (src/utils/)
- [ ] 实现游戏状态序列化
- [ ] 实现动作验证器
- [ ] 实现回放记录器

## 后续计划
- [ ] 实现基础AI代理
- [ ] 添加性能分析工具
- [ ] 实现并行训练支持
- [ ] 添加日志系统

## AI训练框架实现

### 神经网络模型 (src/ai/models.py)
- [ ] 设计网络架构
  - [ ] 实现输入层（状态编码）
  - [ ] 设计卷积层结构
  - [ ] 设计策略头和价值头
  - [ ] 添加残差连接
  - [ ] 实现注意力机制
- [ ] 实现模型保存和加载
- [ ] 添加训练进度可视化

### 训练流程 (src/ai/trainer.py)
- [ ] 实现经验收集器
  - [ ] 实现回放缓冲区
  - [ ] 实现优先级经验回放
  - [ ] 添加多进程数据收集
- [ ] 实现批量训练逻辑
  - [ ] 实现损失函数计算
  - [ ] 实现梯度裁剪
  - [ ] 实现学习率调度
- [ ] 实现模型评估器
  - [ ] 添加验证集评估
  - [ ] 实现早停机制
  - [ ] 实现模型选择
- [ ] 实现检查点保存
  - [ ] 定期保存模型
  - [ ] 保存训练状态
  - [ ] 支持断点续训

### 评估系统 (src/ai/evaluator.py)
- [ ] 实现自我对弈评估
  - [ ] 实现MCTS搜索
  - [ ] 实现并行搜索
  - [ ] 添加温度参数控制
- [ ] 实现ELO评级系统
  - [ ] 实现评分计算
  - [ ] 维护历史模型库
  - [ ] 实现模型匹配
- [ ] 添加性能指标统计
  - [ ] 计算胜率
  - [ ] 统计平均分数
  - [ ] 分析策略多样性
- [ ] 实现评估结果可视化
  - [ ] 绘制学习曲线
  - [ ] 可视化注意力权重
  - [ ] 生成策略热图

### 强化学习算法实现 (src/ai/algorithms/)
- [ ] 实现PPO算法
  - [ ] 实现策略网络
  - [ ] 实现价值网络
  - [ ] 实现GAE计算
- [ ] 实现A2C算法
  - [ ] 实现Actor网络
  - [ ] 实现Critic网络
  - [ ] 实现熵正则化
- [ ] 实现DQN变体
  - [ ] 实现Double DQN
  - [ ] 实现Dueling DQN
  - [ ] 实现Rainbow DQN

### 超参数优化 (src/ai/tuner.py)
- [ ] 实现网格搜索
- [ ] 实现随机搜索
- [ ] 实现贝叶斯优化
- [ ] 实现群体算法

### 可视化和分析工具 (src/ai/viz/)
- [ ] 实现训练监控
  - [ ] 显示实时训练指标
  - [ ] 可视化网络结构
  - [ ] 显示资源使用情况
- [ ] 实现对局回放
  - [ ] 记录完整对局历史
  - [ ] 支持步骤回放
  - [ ] 添加策略分析
- [ ] 实现决策分析
  - [ ] 可视化价值估计
  - [ ] 显示动作概率
  - [ ] 分析关键决策点

## 后续计划
- [ ] 优化训练性能
  - [ ] 使用混合精度训练
  - [ ] 实现模型量化
  - [ ] 添加分布式训练支持
- [ ] 改进AI策略
  - [ ] 实现课程学习
  - [ ] 添加自适应探索
  - [ ] 实现多智能体训练
- [ ] 完善系统功能
  - [ ] 添加Web界面
  - [ ] 实现在线训练
  - [ ] 支持人机对战

## 新增任务

#### 配置系统实现
- [ ] 创建配置文件 (src/config.py)
  - [ ] 添加玩家数量配置
  - [ ] 添加圆盘数量配置
  - [ ] 添加棋子颜色配置

#### 游戏板实现完善
- [ ] 实现结算区颜色模式
  - [ ] 添加固定颜色模式定义
  - [ ] 实现颜色检查方法
- [ ] 完善扣分区
  - [ ] 修改分值设置
  - [ ] 实现从左到右填充逻辑

#### 游戏逻辑优化
- [ ] 完善先手标记处理
  - [ ] 实现与选中棋子一起移动的逻辑
  - [ ] 实现自动进入扣分区的逻辑
- [ ] 优化准备区填充
  - [ ] 实现严格从右到左填充
  - [ ] 添加同色限制检查

#### 结算系统完善
- [ ] 实现连线得分计算
  - [ ] 实现水平连线检测
  - [ ] 实现垂直连线检测
  - [ ] 实现得分计算
- [ ] 实现游戏结束奖励计算
  - [ ] 完整行奖励（2分）
  - [ ] 完整列奖励（7分）
  - [ ] 颜色完成奖励（10分）

#### 测试用例补充
- [ ] 添加先手标记相关测试
- [ ] 添加准备区填充规则测试
- [ ] 添加结算区连线得分测试
- [ ] 添加游戏结束奖励计算测试 