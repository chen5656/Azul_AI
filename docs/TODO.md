# Azul AI 项目 TODO 列表

[ ] board.py 中 记分还是错的.

## 环境类实现 (src/game/environment.py)

### 核心功能实现
- [x] 实现 `_initialize_piece_pool()` 方法
  - [x] 创建正确数量的每种颜色的瓷砖
  - [x] 创建先手标记
  - [x] 实现瓷砖的随机打乱
  
- [x] 实现 `start_new_round()` 方法
  - [x] 将瓷砖分配到圆盘
  - [x] 处理剩余瓷砖
  - [x] 重置回合状态

- [x] 实现 `_execute_action()` 方法
  - [x] 从源位置移除瓷砖
  - [x] 处理同色瓷砖的移动
  - [x] 处理非选中颜色瓷砖的移动到待定区
  - [x] 处理先手标记
  - [x] 返回即时奖励

- [ ] 实现结算相关方法
  - [ ] `_need_scoring()`: 检查是否需要结算
  - [ ] `_perform_scoring()`: 执行结算逻辑
  - [ ] `_calculate_reward()`: 计算动作奖励
  - [ ] `_calculate_final_reward()`: 计算最终奖励

- [ ] 实现 `_check_game_end()` 方法
  - [ ] 检查结算区是否有完整行
  - [ ] 检查回合结束条件

### 改进和优化
- [ ] 添加 seed 方法支持随机数种子设置
- [ ] 优化 `_get_observation()` 方法
  - [ ] 确保所有数组操作使用 np.float32
  - [ ] 添加数据范围检查
  - [ ] 优化数组操作性能

- [ ] 完善 `render()` 方法
  - [ ] 实现人类可读的控制台输出
  - [ ] 实现 RGB 数组输出
  - [ ] 添加可视化选项

### 测试用例编写 (tests/test_environment.py)
- [ ] 基础功能测试
  - [ ] 测试环境初始化
  - [ ] 测试重置功能
  - [ ] 测试动作空间和观察空间

- [ ] 游戏逻辑测试
  - [ ] 测试合法动作生成
  - [ ] 测试动作执行
  - [ ] 测试结算逻辑
  - [ ] 测试游戏结束条件

- [ ] 边界情况测试
  - [ ] 测试非法动作处理
  - [ ] 测试满行/满列情况
  - [ ] 测试扣分区溢出情况

### 文档完善
- [ ] 添加详细的类和方法文档
- [ ] 添加示例代码
- [ ] 添加测试覆盖率报告

## 依赖组件实现

### 游戏组件 (src/game/)
- [x] 实现 `Piece` 类
  - [x] 添加颜色属性
  - [x] 添加位置属性
  - [x] 添加特殊标记（如先手标记）

- [x] 完善 `PlayerBoard` 类
  - [x] 实现 `can_place_pieces()` 方法
  - [x] 实现分数计算逻辑
    - [x] 实现行得分计算
    - [x] 实现列得分计算
    - [x] 实现颜色完成奖励
    - [x] 实现扣分计算
  - [x] 实现板块验证逻辑

### 工具类 (src/utils/)
- [ ] 实现游戏状态序列化
- [ ] 实现动作验证器
- [ ] 实现回放记录器

## 后续计划
- [ ] 实现基础AI代理
- [ ] 添加性能分析工具
- [ ] 实现并行训练支持
- [ ] 添加日志系统

## AI训练框架实现

### 神经网络模型 (src/ai/neural_network.py)
- [ ] 设计网络架构
  - [ ] 实现输入层（状态编码）
  - [ ] 设计卷积层结构
  - [ ] 设计策略头和价值头
- [ ] 实现模型保存和加载
- [ ] 添加训练进度可视化

### 训练流程 (src/ai/trainer.py)
- [ ] 实现经验收集器
- [ ] 实现批量训练逻辑
- [ ] 实现模型评估器
- [ ] 添加早停机制
- [ ] 实现检查点保存

### 评估系统 (src/ai/evaluator.py)
- [ ] 实现自我对弈评估
- [ ] 实现ELO评级系统
- [ ] 添加性能指标统计
- [ ] 实现评估结果可视化

### 新增任务

#### 配置系统实现
- [ ] 创建配置文件 (src/config.py)
  - [ ] 添加玩家数量配置
  - [ ] 添加圆盘数量配置
  - [ ] 添加棋子颜色配置

#### 游戏板实现完善
- [ ] 实现结算区颜色模式
  - [ ] 添加固定颜色模式定义
  - [ ] 实现颜色检查方法
- [ ] 完善扣分区
  - [ ] 修改分值设置
  - [ ] 实现从左到右填充逻辑

#### 游戏逻辑优化
- [ ] 完善先手标记处理
  - [ ] 实现与选中棋子一起移动的逻辑
  - [ ] 实现自动进入扣分区的逻辑
- [ ] 优化准备区填充
  - [ ] 实现严格从右到左填充
  - [ ] 添加同色限制检查

#### 结算系统完善
- [ ] 实现连线得分计算
  - [ ] 实现水平连线检测
  - [ ] 实现垂直连线检测
  - [ ] 实现得分计算
- [ ] 实现游戏结束奖励计算
  - [ ] 完整行奖励（2分）
  - [ ] 完整列奖励（7分）
  - [ ] 颜色完成奖励（10分）

#### 测试用例补充
- [ ] 添加先手标记相关测试
- [ ] 添加准备区填充规则测试
- [ ] 添加结算区连线得分测试
- [ ] 添加游戏结束奖励计算测试 